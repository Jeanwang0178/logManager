<div class="row">
    <div class="span12">

        <div class="widget ">

            <div class="widget-content">
                <h4>日志列表</h4>
                <hr/>
                <div class="alert hide" role="alert"></div>

                <div class="btn-toolbar">
                    <form id="query-from" method="post">
                        <div class="btn-group">
                            <select name="aliasName" id="queryAliasName" class="btn-large"
                                    style="margin-left: 13px">
                                <option value="default" {{if eq .param.aliasName "default" }} selected {{end}} >
                                    default
                                </option>
                                <option value="ecDatabase"  {{if eq .param.aliasName "ecDatabase" }} selected {{end}}>
                                    ecDatabase
                                </option>
                            </select>
                            <input type="text" name="tableName" id="queryTableName"
                                   style="position: relative;float: left;margin-left:13px;"
                                   value="{{.param.tableName}}" placeholder="日志表名称">

                        </div>
                        <p><a style="margin-left:8px;" class="btn btn-large btn-info" onclick="queryLog()">查询</a></p>
                    </form>

                </div>

                <table class="table table-striped table-bordered table-hover">
                    <thead id="tb_head_id">
                    </thead>
                    <tbody id="tb_content_id">
                    </tbody>
                    <tfoot>
                    <tr>
                        <td colspan="100" id="td_pageBar"></td>
                    </tr>
                    </tfoot>
                </table>

            </div>
        </div>
    </div>
</div> <!-- /row -->

<script>

    $("input[name='chkall']").click(function () {
        $("input[name='ids']").attr("checked", $(this).attr("checked") == "checked");
    });


    var url = "{{urlfor "ManagerController.DataView" }}";

    function queryLog(pageNum) {
        $("#tb_head_id").html("");
        $("#tb_content_id").html("");

        var valiasName = $("#queryAliasName").val()
        var vtableName = $("#queryTableName").val()
        if (valiasName == "") {
            showMessage(0, "请选择数据库");
            return
        }
        if (typeof(vtableName) == "undefined" || vtableName == "") {
            showMessage(0, "请输入日志表名称");
            return
        }

        $.post('{{urlfor "ManagerController.QueryDataList"}}', {
            aliasName: valiasName,
            tableName: vtableName,
            page: pageNum
        }, function (out) {
            if (out.code == "success") {

                showMessage(1, out.msg, 1);
                var titleMap = out.titleMap;
                var sortFields = out.sortFields;
                var vpageBar = out.pageBar;
                var vdata = out.data
                var vTheadHtml = "";
                var vTbodyHtml = "";

                $.each(sortFields, function (index, key) {
                    if (key.toLowerCase() == "id") {
                        vTheadHtml = "<tr><th class='span2'>" + titleMap[key] + "</th>" + vTheadHtml;
                    } else {
                        vTheadHtml += "<th class='span2'>" + titleMap[key] + "</th>";
                    }
                })

                vTheadHtml += "</tr>";

                $.each(vdata, function (index, content) {
                    vTbodyHtml = "";
                    $.each(sortFields, function (index, key) {
                        if (key.toLowerCase() == "id") {
                            vTbodyHtml = "<tr><td class='span2'><a href='" + url + "?id=" + content[key] + "&aliasName=" + valiasName + "&tableName=" + vtableName + "' target='_blank'>" + content[key] + "</a></td>" + vTbodyHtml;
                        } else {
                            vTbodyHtml += "<td class='span2'>" + content[key] + "</td>";
                        }
                    })
                    vTbodyHtml += "</tr>";
                    $("#tb_content_id").append(vTbodyHtml);
                })

                $("#tb_head_id").html(vTheadHtml);
                $("#td_pageBar").html(vpageBar)

                var query = out.param;
                $("#queryAliasName").val(query.aliasName);
                $("#queryTableName").val(query.tableName);

                handlerPageBar();

            } else {
                showMessage(0, out.msg, 1);
            }
        }, "json");


    }

    function handlerPageBar() {
        $("#td_pageBar").find("a").each(function () {
            var vhref = $(this).attr("href");
            if (vhref != "#") {
                $(this).attr("href", "#")
                $(this).click(function (e) {
                    var pageNum = Number($(this).text())
                    e.preventDefault()
                    queryLog(pageNum)
                })
            }
        })
    }
    


</script>
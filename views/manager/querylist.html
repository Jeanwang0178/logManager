<div class="row">
    <div class="span12">

        <div class="widget ">

            <div class="widget-content">
                <h4>日志列表</h4>
                <hr/>
                <div class="alert hide" role="alert"></div>

                <div class="btn-toolbar">
                    <form id="query-from" method="post">
                        <div class="btn-group">
                            <select name="aliasName" id="queryAliasName" class="btn-large"
                                    style="margin-left: 13px">
                                <option value="default">default</option>
                                <option value="ecDatabase">ecDatabase</option>
                            </select>
                            <input type="text" name="tableName" id="queryTableName"
                                   style="position: relative;float: left;margin-left:13px;" value="com_biz_log"
                                   {{/*value="{{.param.tableName}}" */}}placeholder="日志表名称">

                        </div>
                        <p><a style="margin-left:8px;" class="btn btn-large btn-info" onclick="queryLog()">查询</a></p>
                    </form>

                </div>

                <table class="table table-striped table-bordered table-hover">
                    <thead id="tb_head_id">
                    </thead>
                    <tbody id="tb_content_id">
                    </tbody>
                {{/*<tfoot>
				<tr><td colspan="100">{{str2html .pageBar}}</td></tr>
			</tfoot>*/}}
                </table>

            </div>
        </div>
    </div>
</div> <!-- /row -->

<script>

    $("input[name='chkall']").click(function () {
        $("input[name='ids']").attr("checked", $(this).attr("checked") == "checked");
    });

    $(document).ready(function () {
        queryLog()
    })

    function queryLog() {
        $("#tb_head_id").html("");
        $("#tb_content_id").html("");

        var valiasName = $("#queryAliasName").val()
        var vtableName = $("#queryTableName").val()
        if (valiasName == "") {
            showMessage(0, "请选择数据库");
            return
        }
        if (typeof(vtableName) == "undefined" || vtableName == "") {
            showMessage(0, "请输入日志表名称");
            return
        }

        $.post('{{urlfor "ManagerController.QueryDataList"}}', {
            aliasName: valiasName,
            tableName: vtableName
        }, function (out) {
            if (out.code == "success") {

                showMessage(1, out.msg, 1);
                var titles = out.titles;
                var sortFields = out.sortFields;
                var data = out.data
                var vTheadHtml = "";
                var vTbodyHtml = "";

                $.each(sortFields, function (index, key) {
                    if (key.toLowerCase() == "id") {
                        vTheadHtml = "<tr><th class='span2'>" + titles[key] + "</th>" + vTheadHtml;
                    } else {
                        vTheadHtml += "<th class='span2'>" + titles[key] + "</th>";
                    }
                })

                vTheadHtml += "</tr>";

                $.each(data, function (index, content) {
                    vTbodyHtml = "";
                    $.each(sortFields, function (index, key) {
                        if (key.toLowerCase() == "id") {
                            vTbodyHtml = "<tr><td class='span2'>" + content[key] + "</td>" + vTbodyHtml;
                        } else {
                            vTbodyHtml += "<td class='span2'>" + content[key] + "</td>";
                        }
                    })
                    vTbodyHtml += "</tr>";
                    $("#tb_content_id").append(vTbodyHtml);
                })

                $("#tb_head_id").html(vTheadHtml);


                var query = out.param;
                $("#queryAliasName").val(query.aliasName);
                $("#queryTableName").val(query.tableName);

            } else {
                showMessage(0, out.msg, 1);
            }
        }, "json");
    }

    function editLog() {
        var vids = $("input[name='ids']").val()
        var url = "{{urlfor "ManagerController.LogView" }}";
        window.open(url + "?id=" + vids)
    }

</script>